<!DOCTYPE html>
<html>

<meta charset=utf-8 />

<head>
    <link rel="stylesheet" type="text/css" href="colorMatchStyle.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
</head>

<body>

<section class="gameContainer">
    <!-- message for end of game -->
    <section class="gameOver">
        <h1>Thanks for playing!</h1>
    </section>
    <!-- row holding target and input color boxes -->
    <section class="gameRow">
        <span class="colorSquare" id="targetSquare" ></span>
        <span class="colorSquare" id="middleSquare" ></span>
        <span class="colorSquare" id="inputSquare" ></span>
    </section>
    <!-- game instructions/progress/data -->
    <section class="gameText">
        <h1>Color Match:</h1>
        <p>Use the sliders to match the color on the right to the one on the left.</p>
        <p>Click the Match button when the colors are the same.</p>
    </section>
    <!-- row with RGB sliders -->
    <section class="sliders gameRow">
        <input type="range" min="0" max="255" value="127" class="slider" id="redSlider">
        <input type="range" min="0" max="255" value="127" class="slider" id="greenSlider">
        <input type="range" min="0" max="255" value="127" class="slider" id="blueSlider">
    </section>
    <!-- row with match (and/or reset) button -->
    <section class="gameRow">
        <!--<button id="resetButton">Reset</button>-->
        <button id="matchButton">Match</button>
    </section>
    <!-- button to start or retart game -->
    <section class="newGame">
        <button>Start New Game</button>
    </section>
</section>

<!-- DEBUG: trial and average data -->
<!--<section class="dataTable">-->
    <!--<table>-->
        <!--<tr>-->
            <!--<td># of Trials</td>-->
            <!--<td>Red Error</td>-->
            <!--<td>Grn Error</td>-->
            <!--<td>Blu Error</td>-->
            <!--<td>Trial Error</td>-->
            <!--<td>Trial Seconds</td>-->
            <!--<td>Avg Sceonds</td>-->
        <!--</tr>-->
        <!--<tr>-->
            <!--<td id="tableTrials">0</td>-->
            <!--<td id="tableRError">-</td>-->
            <!--<td id="tableGError">-</td>-->
            <!--<td id="tableBError">-</td>-->
            <!--<td id="tableTrialAvg">-</td>-->
            <!--<td id="tableTrialSeconds">-</td>-->
            <!--<td id="tableAvgSeconds">-</td>-->
        <!--</tr>-->
    <!--</table>-->
<!--</section>-->


<script>

    // game settings
    var colorSquareSize = 200;
    var colorSquareSpacing = 200;
    var trialsPerGame = 3;

    var trialStartTime = 0;
    var trialSeconds = 0;
    var trialSecondsAverage = 0;

    var trialNumber = 0;
    var meanTrialError = 0;
    var meanTrialErrorAverage = 0;

    var redInput = 127;
    var greenInput = 127;
    var blueInput = 127;

    var redTarget = 0;
    var greenTarget = 0;
    var blueTarget = 0;

    var redError = 0;
    var greenError = 0;
    var blueError = 0;

    var redErrorAverage = 0;
    var greenErrorAverage = 0;
    var blueErrorAverage = 0;

    // check slider values against target RGB and compute data
    $("#matchButton").click( function() {

        // record the amount of time between display and match
        trialSeconds = ((new Date).getTime() - trialStartTime) / 1000;

        // get error values for this trial
        redError = Math.abs(redTarget - redInput);
        greenError = Math.abs(greenTarget - greenInput);
        blueError = Math.abs(blueTarget - blueInput);
        meanTrialError = (redError + greenError + blueError) / 3;

        // update average errors
        redErrorAverage = ((redErrorAverage * (trialNumber-1)) + redError) / trialNumber;
        greenErrorAverage = ((greenErrorAverage * (trialNumber-1)) + greenError) / trialNumber;
        blueErrorAverage = ((blueErrorAverage * (trialNumber-1)) + blueError) / trialNumber;
        meanTrialErrorAverage = ((meanTrialErrorAverage * (trialNumber-1)) + meanTrialError) / trialNumber;
        trialSecondsAverage = ((trialSecondsAverage * (trialNumber-1)) + trialSeconds) / trialNumber

        // DEBUG: display data on table
        // $("#tableTrials").html(trialNumber);
        // $("#tableRError").html(redError);
        // $("#tableGError").html(greenError);
        // $("#tableBError").html(blueError);
        // $("#tableTrialAvg").html(parseFloat(meanTrialError).toFixed(2));
        // $("#tableRunAvg").html(parseFloat(meanTrialErrorAverage).toFixed(2))
        // $("#tableTrialSeconds").html(parseFloat(trialSeconds).toFixed(2));
        // $("#tableAvgSeconds").html(parseFloat(trialSecondsAverage).toFixed(2));

        // check to see if game over
        if (trialNumber >= trialsPerGame) {

            // hide game stuff
            $(".gameRow").css("display","none");

            // display new game button
            $(".gameOver, .newGame").css("display","flex");

            // display table of average errors and time
            $(".gameText").html(
                "<table>" +
                    "<tr>" +
                        "<td> Average Red Error </td>" +
                        "<td>" + parseFloat(redErrorAverage).toFixed(2) + "</td>" +
                    "</tr>" +
                    "<tr>" +
                        "<td> Average Green Error </td>" +
                        "<td>" + parseFloat(greenErrorAverage).toFixed(2) + "</td>" +
                    "</tr>" +
                    "<tr>" +
                        "<td> Average Blue Error </td>" +
                        "<td>" + parseFloat(blueErrorAverage).toFixed(2) + "</td>" +
                    "</tr>" +
                    "<tr>" +
                        "<td> Average Mean Trial Error </td>" +
                        "<td>" + parseFloat(meanTrialErrorAverage).toFixed(2) + "</td>" +
                    "</tr>" +
                    "<tr>" +
                        "<td> Average Time (Seconds) </td>" +
                        "<td>" + parseFloat(trialSecondsAverage).toFixed(2) + "</td>" +
                    "</tr>" +
                "</table>"
            );

        } else { // go to next trial in game

            // increment number of trials completed
            trialNumber += 1;
            $(".gameText").html("Trial: " + trialNumber + "/" + trialsPerGame);

            // reset squares for next trial
            resetColorSquares();

            // restart trial timer
            trialStartTime = (new Date).getTime();
        }

    });

    // starts a new game with a random target color and grey input square
    $(".newGame").click( function () {

        // create game squares with desired sizes and spacing
        $(".colorSquare").width(colorSquareSize).height(colorSquareSize);
        $("#middleSquare").css("width", colorSquareSpacing);

        // give squares initial colors
        resetColorSquares();

        // hide start button and end message (if present)
        $(".newGame, .gameOver").css("display","none");

        // display game
        $(".gameRow, .gameText").css("display","flex");
        $(".gameText").html("Trial: 1/" + trialsPerGame);

        // reset game state
        trialNumber = 1;
        trialSecondsAverage = 0;
        meanTrialErrorAverage = 0;
        redErrorAverage = 0;
        greenErrorAverage = 0;
        blueErrorAverage = 0;

        // start trial timer
        trialStartTime = (new Date).getTime();
    });

    // gets values from all sliders whenever one slider changes
    $(".sliders").change(function() {
        redInput = $("#redSlider").val();
        greenInput = $("#greenSlider").val();
        blueInput = $("#blueSlider").val();
        $("#inputSquare").css("background", "rgb(" + redInput + "," + greenInput + "," + blueInput + ")");
    });

    // resets target and input squares
    function resetColorSquares() {
        // randomize target square
        redTarget = Math.floor(Math.random() * 256);
        greenTarget = Math.floor(Math.random() * 256);
        blueTarget = Math.floor(Math.random() * 256);
        $("#targetSquare").css("background", "rgb(" + redTarget + "," + greenTarget + "," + blueTarget + ")");
        // make input square grey
        $("#redSlider").val(127);
        $("#greenSlider").val(127);
        $("#blueSlider").val(127);
        $("#inputSquare").css("background", "rgb(" + 127 + "," + 127 + "," + 127 + ")");
    }

    // DEBUG: reset colors without recording error
    $("#resetButton").click( function() {

        // reset squares
        resetColorSquares();

        // reset trial timer
        trialStartTime = (new Date).getTime();
    });



</script>

</body>
</html>
